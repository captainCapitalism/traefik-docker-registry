version: "3"

services:
  registry:
    restart: always
    image: registry:2
    ports:
        - "${REGISTRY__EXTERNAL_PORT}:${REGISTRY__INTERNAL_PORT}"

    environment:
        REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY: /data
        REGISTRY_HTTP_ADDR: "0.0.0.0:${REGISTRY__INTERNAL_PORT}"
    volumes:
      - ./registry/data:/data
      - ./registry/config.yml:/etc/docker/registry/config.yml

  # Source: https://github.com/Joxit/docker-registry-ui
  registry-ui:
    restart: always
    image: joxit/docker-registry-ui:2
    ports:
      - "${UI__EXTERNAL_PORT}:80"
    environment:
        REGISTRY_TITLE: "My Registry"
        REGISTRY_URL: "http://localhost:${REGISTRY__EXTERNAL_PORT}"
        REGISTRY_NAME: "My Registry"
        REGISTRY_SSL: "false"
    depends_on:
        - registry

